/**************************************************************************//**
 * @file     main.c
 * @brief    USG-mini generator main board firmware
 * @version  V1.00
 * @date     21. September 2015
 * @author   Nickstar
 *
 * @note
 *
 ******************************************************************************/
/* Copyright (c) 2015 MedPromPrylad

   ---------------------------------------------------------------------------*/

// ---------------------------------------------------------------------------
// Basic definitions
// ---------------------------------------------------------------------------
#define  INTERFACE_TYPE   TERMINAL
                          //TERMINAL
													//I2C 
													//NONE

// ---------------------------------------------------------------------------
// Includes
// ---------------------------------------------------------------------------
#include "main.h"

// ---------------------------------------------------------------------------
// Global variables
// ---------------------------------------------------------------------------
#if (INTERFACE_TYPE == TERMINAL)
  char TX_buffer[128];
  char RX_buffer[64];
#endif

// Additional global variables
uint16_t delay_count = 0;

// ---------------------------------------------------------------------------
// Interrupt handlers
// ---------------------------------------------------------------------------
void SysTick_Handler (void)
{
  if (delay_count > 0) {delay_count--;} 
}
	
// ---------------------------------------------------------------------------
// Utilites
// ---------------------------------------------------------------------------
void Delay_ms (uint16_t delay)
{
	delay_count = delay;
	while (delay_count){};
}

// ---------------------------------------------------------------------------
// Main()
// ---------------------------------------------------------------------------
int main(void){
	int i;	
	
	// ---------------------------------------------------------------------------
  // Init section
  // ---------------------------------------------------------------------------
	SysTick_Config(SystemCoreClock / 1000); // 1 ms
	
	GPIO_init();
	USART_init_();
  //DMA_USART_TX_init();
  
	// Main loop
	while(1){
		
		//Delay_ms(250);
		GPIO_SetBits(GPIOA, GPIO_Pin_0);
		
		for (i=0;i<1000000;i++);
		
		USART_SendData(USART1, 0xAA);
		
		GPIO_ResetBits(GPIOA, GPIO_Pin_0);
		//Delay_ms(250);
		for (i=0;i<1000000;i++);
		USART_SendData(USART1, 0x55);
	}
}
